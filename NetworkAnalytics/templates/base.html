<!DOCTYPE html>
<html lang="en">

<!-- This is the linking section -->
<script   src="https://code.jquery.com/jquery-3.3.1.min.js"   integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="   crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-rc.1/css/materialize.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-rc.1/js/materialize.js" type="text/javascript"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link href="../static/css/nalvp.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js" type="text/javascript"></script>

<!-- UIkit CSS -->
<!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.5/css/uikit.min.css" />-->

<!-- UIkit JS -->
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.5/js/uikit.min.js"></script>-->
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.5/js/uikit-icons.min.js"></script>-->

<script src="../static/node_modules/dropify/dist/js/dropify.js" type="text/javascript"></script>
<link href="../static/node_modules/dropify/dist/css/dropify.css" rel="stylesheet" />

<script src="../static/node_modules/chart.js/dist/Chart.bundle.min.js" type="text/javascript"></script>

<head>
    <meta charset="UTF-8">
    {% block title %}
    <title>Admin tools Base</title>
    {% endblock %}
</head>

<body>

     <!-- This is the navbar component -->
    <nav>
        <div class="nav-wrapper grey darken-4">
            <a href="#" data-target="slide-out" class="sidenav-trigger show-on-large"><i class="material-icons">menu</i></a>
            <div class="brand-logo center grey darken-4">LVPEI Network Analytics</div>
            <ul id="nav-mobile" class="left hide-on-med-and-down">
            </ul>
        </div>
    </nav>

    <!-- This is the component for the side nav -->
    <ul id="slide-out" class="sidenav">
        <li>
            <!--<div class="user-view">-->
            <!--    <div class="background">-->
            <!--        <img src="images/office.jpg">-->
            <!--    </div>-->
            <!--    <a href="#user"><img class="circle" src="images/yuna.jpg"></a>-->
            <!--    <a href="#name"><span class="white-text name">John Doe</span></a>-->
            <!--    <a href="#email"><span class="white-text email">jdandturk@gmail.com</span></a>-->
            <!--</div>-->
        </li>
        <li><h>Menu</h></li>
        <li><a href="/individualAnalytics/"> Statistical </a></li>
        <li><a href="#!"> Performance </a></li>
        <li><a href="#!"> Previous Reports </a></li>
        <li><a href="/rxukDcskAnhJMZN2nvuJSqajtcAh9Yd0XD9KmpWmt5rlMmF6xNbCEyktm6aXho2T/admin/"> Admin </a></li>
        <li><div class="divider"></div></li>
        <li><a class="subheader"> Reports </a></li>
        <li><a class="waves-effect" href="#!"> This is where reports will go </a></li>
    </ul>

    <!-- This is the upload file component -->
    <form id="file-form" class="file_upload">
        <input type="file" id="file-select" class="dropify" name="uploaded_file" multiple/>
        <button class="upload_button" id="upload-button" type="submit">Upload</button>
    </form>

    {% block body %}

    {% endblock %}

</body>

<script>

    var form = document.getElementById('file-form');
    var fileSelect = document.getElementById('file-select');
    var uploadButton = document.getElementById('upload-button');

    $('form.file_upload').on('submit', function () {
        // The following line is to prevent the html submit button from executing its function
        event.preventDefault();

        // Update button text.
        uploadButton.innerHTML = 'Uploading...';

        var files = fileSelect.files;

        // Create a new FormData object.
        var formData = new FormData();

        formData.append('uploaded_file', files[0], files[0].name);

        $.ajax({
            type: "POST",
            url: '/uploadData/',
            data: formData,
            beforeSend: function(xhr, cashless) {
                function getCookie(name) {
                    var cookieValue = null;
                    if (document.cookie && document.cookie != '') {
                        var cookies = document.cookie.split(';');
                        for (var i = 0; i < cookies.length; i++) {
                            var cookie = jQuery.trim(cookies[i]);
                            // Does this cookie string begin with the name we want?
                            if (cookie.substring(0, name.length + 1) == (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                }
                xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
            },
            contentType: false,
            processData: false,
            success: function(data, text, an_text) {
                uploadButton.innerHTML = 'Upload';
                console.log("Success");
                console.log(data);
                getData();
            },
            error: function(error) {
                console.log(error);
                console.log("Error");
            }
        });
    })

    function getData() {
        $.ajax({
            type: "GET",
            url: '/devices/',
            beforeSend: function(xhr, cashless) {
                function getCookie(name) {
                    var cookieValue = null;
                    if (document.cookie && document.cookie != '') {
                        var cookies = document.cookie.split(';');
                        for (var i = 0; i < cookies.length; i++) {
                            var cookie = jQuery.trim(cookies[i]);
                            // Does this cookie string begin with the name we want?
                            if (cookie.substring(0, name.length + 1) == (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                }
                xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
            },
            contentType: false,
            dataType: 'json',
            // processData: false,
            success: function(data, text, an_text) {
                console.log("This is the second request");
                console.log("Success");
                console.log(data);
                console.log(typeof(data[0]));
                console.log(data[0]);
                console.log("Device name part 2");
                console.log(data[0].device_name)

                const form_data = {
                    "device_name": data[0].device_name
                };
                console.log("Form Data");
                console.log(form_data);

                console.log(JSON.stringify(form_data));

                $.ajax({
                    type: "POST",
                    url: '/individualAnalytics/',
                    data: JSON.stringify(form_data),
                    beforeSend: function(xhr, cashless) {
                        function getCookie(name) {
                            var cookieValue = null;
                            if (document.cookie && document.cookie != '') {
                                var cookies = document.cookie.split(';');
                                for (var i = 0; i < cookies.length; i++) {
                                    var cookie = jQuery.trim(cookies[i]);
                                    // Does this cookie string begin with the name we want?
                                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                        break;
                                    }
                                }
                            }
                            return cookieValue;
                        }
                        xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
                    },
                    contentType: 'application/json',
                    // dataType: false,
                    // processData: false,
                    success: function(data, text, an_text) {
                        console.log("This is the second request");
                        console.log("Success");
                        console.log(data);
                    },
                    error: function(error) {
                        console.log(error);
                        console.log("Error");
                    }
                });


            },
            error: function(error) {
                console.log(error);
                console.log("Error");
            }
        });
    };
</script>
<script src="../static/js/nalvp.js" type="text/javascript"></script>

</html>